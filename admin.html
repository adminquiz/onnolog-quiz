<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel ADM Setorial</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .login-box { max-width: 300px; margin: 100px auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        .dash { display: none; max-width: 800px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        input, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ddd; }
        button { background: #003366; color: white; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border-bottom: 1px solid #eee; padding: 10px; text-align: left; }
    </style>
</head>
<body>

    <div id="login" class="login-box">
        <h2>ADM OnnoLog</h2>
        <input type="text" id="setor" placeholder="Setor">
        <input type="password" id="senha" placeholder="Senha">
        <button onclick="logar()">ENTRAR</button>
    </div>

    <div id="dash" class="dash">
        <div style="display:flex; justify-content: space-between;">
            <h1 id="titulo">Painel</h1>
            <button onclick="location.reload()" style="width: 80px; background: red;">SAIR</button>
        </div>

        <div class="card">
            <h3>Cadastrar Pergunta</h3>
            <input type="text" id="p" placeholder="Pergunta">
            <input type="text" id="c" placeholder="Opção Correta">
            <input type="text" id="e" placeholder="Opção Errada">
            <button onclick="addP()">SALVAR PERGUNTA</button>
        </div>

        <div class="card">
            <h3>Ranking do Setor</h3>
            <table id="tabela">
                <thead><tr><th>Nome</th><th>Pontos</th><th>Acertos</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        const _supabase = supabase.createClient('https://zdthxlhknxpbdfzcozls.supabase.co', 'sb_publishable_6gT5fcstwt1QLjCf5PCAPA_2Ec_6mU4');
        let setorAtivo = "";

        async function logar() {
            const s = document.getElementById('setor').value;
            const p = document.getElementById('senha').value;
            const { data } = await _supabase.from('gestores').select('*').eq('setor', s).eq('senha', p).single();

            if(data) {
                setorAtivo = s;
                document.getElementById('login').style.display = 'none';
                document.getElementById('dash').style.display = 'block';
                document.getElementById('titulo').innerText = "ADM: " + s;
                carregar();
            } else alert("Acesso inválido!");
        }

        async function carregar() {
            const { data } = await _supabase.from('ranking').select('*').eq('setor', setorAtivo).order('pontos', {ascending:false});
            const { data: q } = await _supabase.from('perguntas').select('*').eq('setor', setorAtivo);
            const totalQ = q ? q.length : 0;
            
            document.querySelector('#tabela tbody').innerHTML = data.map(r => `
                <tr><td>${r.nome}</td><td>${r.pontos}</td><td>${r.acertos_reais}/${totalQ}</td></tr>
            `).join('');
        }

        async function addP() {
            const per = document.getElementById('p').value;
            const cor = document.getElementById('c').value;
            const err = document.getElementById('e').value;
            await _supabase.from('perguntas').insert([{ pergunta: per, opcoes: [cor, err], correta: 0, setor: setorAtivo }]);
            alert("Pergunta salva!");
            carregar();
        }
    </script>
</body>
</html>
